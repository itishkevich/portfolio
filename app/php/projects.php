<?php	require_once 'db_connect.php';	function processing_url($url) {		if(strcasecmp(substr($url,0,7), 'http://') == 0) $url = substr($url, 7);		if(strcasecmp(substr($url,0,4), 'www.') == 0) $url = substr($url, 4);		$url_len = strlen($url)-1;		if(strcasecmp(substr($url, $url_len), '/') == 0) $url = substr($url, 0, $url_len);		return $url;	}	if($_SERVER['REQUEST_METHOD'] == "POST") {		// File upload fields		$file = $_FILES['upload'];		$file_name = $file['name'];		$file_dir = dirname(__DIR__).'/img/uploads/'.$file_name;		$file_ext = pathinfo($file_name, PATHINFO_EXTENSION);		$allowed = array('gif','png','jpg','jpeg');		// DB fields		$name = $_POST['name'];		$file_path = '/img/uploads/'.$file_name;		$url = $_POST['url'];		$descr = $_POST['msg'];		// Chek url		if(strpos(trim($url), 'http://') !== 0) {			$url = 'http://' . $url;		} else {			$url = $_POST['url'];		}		$url_text = processing_url($url);		$query = "INSERT INTO tbl_projects (img_path, site_name, site_link, site_link_text, site_descr) VALUES ('$file_path', '$name', '$url', '$url_text', '$descr')";		// Check img		if(!in_array($file_ext, $allowed)) {			$response = array(				'status' => 'FAIL',				'msg' => 'Некорректный формат. Загрузите jpg, png или gif'			);		} else if(move_uploaded_file($file['tmp_name'], $file_dir)){			$result = mysql_query($query);			if ($result == 'true') {				$response = array(					'status' => 'OK',					'msg' => 'Проект успешно добавлен',					'project' => array(						'file_path' => $file_path,						'name' => $name,						'url' => $url,						'url_text' => $url_text,						'descr' => $descr					)				);			} else {				$response = array(					'status' => 'FAIL',					'msg' => 'Возникла ошибка при загрузке файла на сервер'				);			}		}		echo json_encode($response);	} else {		header("HTTP/1.1 302 Moved Temporarily");		header("Location: /");		exit;	}